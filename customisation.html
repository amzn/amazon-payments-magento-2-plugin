<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Frontend Customisation &mdash; Amazon Pay for Magento 2 documentation</title>
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="top" title="Amazon Pay for Magento 2 documentation" href="index.html" />
  <link rel="next" title="Testing your integration" href="testing.html" />
  <link rel="prev" title="Order &amp; payment workflow" href="flow.html" />
  <script src="_static/js/modernizr.min.js"></script>
</head>
<body class="wy-body-for-nav" role="document">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          <a href="index.html" class="icon icon-home"> Amazon Pay for Magento 2
          </a>
        </div>
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <ul class="current">
            <li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
            <li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
            <li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
            <li class="toctree-l1"><a class="reference internal" href="signin.html">Amazon Sign-in</a></li>
            <li class="toctree-l1"><a class="reference internal" href="flow.html">Order &amp; payment workflow</a></li>
            <li class="toctree-l1 current"><a class="current reference internal" href="#">Frontend Customisation</a>
              <ul>
                <li class="toctree-l2"><a class="reference internal" href="#pwa">Support for <cite>Progressive Web
                      Apps/Headless Commerce/Single Page Applications</cite></a></li>
                <li class="toctree-l2"><a class="reference internal" href="#notes">Notes on the Checkout Session API</a></li>
                <li class="toctree-l2"><a class="reference internal" href="#configurable-urls">Configurable URLs</a></li>
                <li class="toctree-l2"><a class="reference internal" href="#sign-in-with-amazon">Sign in with Amazon</a></li>
                <li class="toctree-l2"><a class="reference internal" href="#docs">API Documentation</a></li>
                <li class="toctree-l2"><a class="reference internal" href="#custom-rendering">Rendering Amazon Buttons in a Custom Location</a></li>
                <!-- <li class="toctree-l2"><a class="reference internal" href="#q-i-d-like-to-add-a-amazon-pay-or-login-with-amazon-button-elsewhere-on-my-site">How to add <cite>Amazon Pay</cite> or <cite>Amazon Sign-in</cite> buttons elsewhere on a website</a></li> -->
              </ul>
            </li>
            <li class="toctree-l1"><a class="reference internal" href="testing.html">Testing your integration</a></li>
            <li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
            <li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions (FAQ)</a>
            </li>
            <li class="toctree-l1"><a class="reference internal" href="m1_m2_migration.html">Migration: Magento 1 to
                Magento 2</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Amazon Pay for Magento 2</a>
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ul class="wy-breadcrumbs">
              <li><a href="index.html">Docs</a> &raquo;</li>
              <li>Frontend Customisation</li>
              <li class="wy-breadcrumbs-aside">
              </li>
            </ul>
            <hr />
          </div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div itemprop="articleBody">
              <div class="section" id="frontend-customisation">
                <h1>Frontend Customisation<a class="headerlink" href="#frontend-customisation"
                    title="Permalink to this headline">¶</a></h1>
                <div class="section" id="pwa">
                  <h2>Support for <cite>Progressive Web Apps/Headless Commerce/Single Page Applications</cite><a
                      class="headerlink" href="#pwa" title="Permalink to this headline">¶</a></h2>
                  <p>The module exposes the REST endpoints that needs to set up. You can find them <a
                      class="reference external" target="_blank"
                      href="https://github.com/amzn/amazon-payments-magento-2-plugin/blob/master/etc/webapi.xml">here</a>.
                    The front-end needs to be setup by the merchant/developer.</p>
                </div>
                <div class="section" id="notes">
                  <h2>Notes on the Checkout Session API<a class="headerlink" href="#notes"
                    title="Permalink to this headline">¶</a></h2>
                  <p>The <strong>Checkout Session API</strong> exposes a number of endpoints to manage active 
                      Amazon checkout sessions associated with an active cart in a Magento store. Available endpoints 
                      include functionality such as retrieving configuration information used to generate an Amazon 
                      Pay button, retrieving shipping addresses associated with an Amazon account, and updating a checkout 
                      session by setting payment/shipping/billing information, etc.
                  </p>
                  <p>The following flowchart illustrates the sequence in which these calls may be made through a 
                    normal shopping/checkout flow:
                  </p>
                  <img alt="_images/api_calls.png" src="_images/api_calls.png" />
                  <div class="section" id="config">
                    <h3>Checkout Session Config<a class="headerlink" href="#config"
                      title="Permalink to this headline">¶</a></h3>
                    <p>
                      Values returned from this endpoint will be needed to generate the Sign In with Amazon and Amazon Pay buttons. 
                      The format of this response will be:
                      <div class="highlight-xml">
                        <div class="highlight">
                          <pre>
    [
      {
        "merchant_id": string,
        "currency": string,
        "button_color": string,
        "language": string,
        "sandbox": boolean,
        "login_payload": string,
        "login_signature": string,
        "checkout_payload": string,
        "checkout_signature": string,
        "public_key_id": string,
        "pay_only": boolean
        "paynow_payload": string,
        "paynow_signature": string
      }
    ]</pre>
                        </div>
                      </div>
                      <div class="admonition note">
                        <p class="first admonition-title">Note</p>
                        <p class="last">The value for <cite>productType</cite> returned in the response will be a boolean value indicating 
                        whether the product is PayOnly; true for PayOnly, false for PayAndShip.</p>
                      </div>
                      For a detailed explanation on how to use these values to generate:
                      <br/><br/>
                      <ul>
                        <li>
                          A Sign In With Amazon Button, see <a 
                            href="https://developer.amazon.com/docs/amazon-pay-checkout/amazon-sign-in.html#4-render-the-button"
                            target="_blank">
                          Amazon Sign-in (Render the Button)</a>.
                        </li>
                        <li>
                          An Amazon Pay Button, see <a 
                            href="https://developer.amazon.com/docs/amazon-pay-checkout/add-the-amazon-pay-button.html#4-render-the-button"
                            target="_blank">
                          Add the Amazon Pay Button (Render the Button)</a>.
                        </li>
                      </ul>
                    </p>
                  </div>
                  <div class="section" id="shipping-payment">
                    <h3>Shipping and Payment Information<a class="headerlink" href="#shipping-payment"
                      title="Permalink to this headline">¶</a></h3>
                      <p>
                        The Shipping Address, Payment Descriptor, and Billing Address endpoints are used to retrieve order summary information 
                        to display upon checkout review. Shipping and payment method updates can be enabled to allow the user to choose a different 
                        shipping address or payment instrument before placing an order.
                        <div class="admonition note">
                          <p class="first admonition-title">Note</p>
                          <p class="last">The value for <cite>shippingAddress</cite> should be null for PayOnly product types. Similarly, <cite>billingAddress</cite> 
                          should only be populated in EU or for PayOnly product types.</p>
                        </div>
                      </p>
                      <p>
                        For recommended best practices regarding displaying this 
                        information, see <a 
                          href="https://developer.amazon.com/docs/amazon-pay-checkout/display-shipping-payment-info.html#1-get-shipping-and-payment-info"
                          target="_blank">
                        Display shipping and payment info (Best Practice)</a>.
                      </p>
                      <p>
                        For a guide on enabling shipping and payment information updates at checkout review, see <a 
                          href="https://developer.amazon.com/docs/amazon-pay-checkout/display-shipping-payment-info.html#2-enable-shipping-and-payment-updates"
                          target="_blank">
                        Enable shipping and payment updates</a>.
                      </p>
                  </div>
                </div>
                <div class="section" id="configurable-urls">
                  <h2>Configurable URLs<a class="headerlink" href="#configurable-urls" title="Permalink to this headline">¶</a></h2>
                  <p>
                    In order to provide more control over redirects from Amazon during the checkout process, several configuration options are 
                    available to define locations for checkout session logic in a headless implementation. See the URL options in 
                    <a class="reference internal" href="configuration.html#developer-options">Developer Options</a> for a description of the configurable 
                    locations.
                    </p>
                    <p>
                      An example sequence of how these redirects may be used looks like the following:
                      <ul>
                        <li>Amazon Pay button is rendered at checkout page</li>
                        <li>User authenticates through Amazon and is redirected to <strong>Amazon Checkout Review Return URL</strong> with an 
                        amazonCheckoutSessionId in the query string</li>
                        <li>Sign user in to Magento store, then redirect to <strong>Magento Checkout URL Path</strong> with amazonCheckoutSessionId 
                        in the query string</li>
                        <li>Use checkout session ID and checkout session API endpoints to set/display shipping information and payment 
                        descriptor</li>
                        <li>User places order, call the checkout session API /update endpoint; a processing URL is returned</li>
                        <li>Redirect user to processing URL, and Amazon redirects user to <strong>Amazon Checkout Result Return URL</strong></li>
                        <li>Call checkout session API /complete endpoint, and redirect user to <strong>Magento Checkout Result URL Path</strong> upon 
                        success</li>
                      </ul>
                    </p>
                  </p>
                </div>
                <div class="section" id="sign-in-with-amazon">
                  <h2>Sign in with Amazon<a
                      class="headerlink" href="#sign-in-with-amazon" title="Permalink to this headline">¶</a></h2>
                  <p>
                    The module exposes two REST endpoints that enable Sign in with Amazon for headless implementations.
                  </p>
                  <div class="section" id"sign-in-config">
                    <h3>Configuration<a class="headerlink" href="#sign-in-config"
                      title="Permalink to this headline">¶</a></h3>
                      <p>
                        The configurable URL <b>Sign In Result URL Path</b> defines a location where your implementation 
                        should be able to handle an authentication response from Amazon. By default, this location is 
                        amazon_pay/login/authorize.
                      </p>
                      <div class="admonition note">
                        <p class="first admonition-title">Note</p>
                        <p class="last">The configuration value for <cite>Amazon Sign-in</cite> must be set to <b>Enabled</b>
                         in order to receive successful responses from the sign in endpoint.</p>
                      </div>
                  </div>
                  <div class="section" id"sign-in-usage">
                    <h3>Usage<a class="headerlink" href="#sign-in-usage"
                      title="Permalink to this headline">¶</a></h3>
                      <p>
                        The redirect to the Sign In Result URL will include a buyerToken as a parameter in the URL. This 
                        buyerToken can be used in a request to <b>/V1/amazon-checkout-session/signin/{buyer-token}</b> which 
                        will return a response similar to:
                        <div class="xml-highlight">
                          <div class="highlight">
                            <pre>
    [
      {
        "success": true,
        "customer_id": 201,
        "customer_firstname": "Susie",
        "customer_last": "Smith",
        "customer_bearer_token": "0wjzxdjnaus5dxdy9qwz2kgp9poftu1u"
      }
    ]
                            </pre>
                          </div>
                        </div>
                        The bearer token included in the response can be used in future requests to authenticated resources 
                        (e.g., My Account page).
                      </p>
                  </div>
                  <div class="section" id"customer-exists">
                    <h3>Customer Already Exists<a class="headerlink" href="#customer-exists"
                      title="Permalink to this headline">¶</a></h3>
                      <p>
                        In the case that a Magento store customer already exists with the same email address that was 
                        used to sign in through Amazon, another endpoint is provided in order to link the Amazon 
                        customer with the store customer. If this happens, the response from the sign in endpoint will 
                        look similar to:
                        <div class="xml-highlight">
                          <div class="highlight">
                            <pre>
    [
      {
        "success": false,
        "customer_email": "customer@amazon.com",
        "message": "A store account for this email address already exists. Please enter your store account password to log in without leaving the store."
      }
    ]
                            </pre>
                          </div>
                        </div>
                        From here, the user should be redirected to a page where they can provide their store password 
                        and the message included in the previous response can be displayed. Once the password is submitted, 
                        a POST request can be made to <b>/V1/amazon-checkout-session/setcustomerlink</b> with a body of 
                        the form:
                      </p>
                      <div class="xml-highlight">
                        <div class="highlight">
                          <pre>
  {
    "buyerToken": "eyJ6aXAiOiJERUYiLCJl...HCGVKINr557b2hxk77webg",
    "password": "supplied_password"
  }
                          </pre>
                        </div>
                      </div>
                      <p>
                        A successful response will look similar to a success response from the sign in endpoint.
                      </p>
                  </div>
                </div>
                <div class="section" id="docs">
                  <h2>API Documentation<a
                      class="headerlink" href="#docs" title="Permalink to this headline">¶</a></h2>
                  <p>
                    The Amazon Pay module offers both a <a class="reference internal" target="_blank" href="rest-docs.html">REST API</a>
                    and a <a class="reference internal" target="_blank" href="graphql-docs.html">GraphQL API</a> depending on the needs of 
                    the frontend project. Click on the links to see detailed information about available endpoints (REST), request/response 
                    formats, and example responses from both interfaces.
                  </p>
                </div>
                <div class="section" id="custom-rendering">
                  <h2>Rendering Amazon Buttons in a Custom Location<a
                    class="headerlink" href="#custom-rendering" title="Permalink to this headline">¶</a></h2>
                  <p>
                    You may wish to display an Amazon Pay button somewhere other than the default options (cart, minicart, checkout, 
                    or with payment methods). A recommended solution is loading the amazon-button.js script in a custom block/template 
                    similar to how the module renders the minicart button:
                  </p>
                  <div class="highlight-html">
                    <div class="highlight">
                      <pre>
  &ltdiv id="PayWithAmazon-Cart"
    class="amazon-checkout-button"
    data-loaded-at="&lt?= $block->escapeHtml(time()) // added for force re-rendering ?&gt"
    data-mage-init='{"Amazon_Pay/js/amazon-button": {"hideIfUnavailable": ".amazon-button-container"}}'&gt
  &lt/div&gt</pre>
                    </div>
                  </div>
                  <p>
                    See <a class="reference external" 
                      href="https://github.com/amzn/amazon-payments-magento-2-plugin/blob/master/view/frontend/templates/minicart-button.phtml#L28-L32"
                      target="_blank">
                    the minicart button template</a> in the module repository for a full example.
                  </p>
                  <p>Simlarly, if you wish to add an Amazon Sign In Button somewhere other than the login page, you can do so using the same method:</p>
                  <div class="highlight-html">
                    <div class="highlight">
                      <pre>
  &ltdiv class="amazon-sign-in-button-container"&gt
    &ltdiv class="amazon-sign-in-button-container__cell"&gt
      &ltdiv id="AmazonPayButton"
          class="login-with-amazon"
          data-mage-init='{"amazonPayLoginButton": {}}'&gt
      &lt/div&gt
    &lt/div&gt
  &lt/div&gt</pre>
                    </div>
                  </div>
                  <p>Be sure that your block class/layout files check to make sure the module is active, and the <em>Amazon Sign-In</em> 
                    setting is set to <strong>Enabled</strong> before rendering. Refer to <a class="reference external" 
                    href="https://gist.github.com/sgabhart22/1e2f314ed5f1bdfe185d5a11b92882f7"
                    target="_blank">this gist</a> for a more complete example.</p>
                </div>
                <!-- <div class="section" id="q-i-d-like-to-add-a-amazon-pay-or-login-with-amazon-button-elsewhere-on-my-site">
    <h2>How to add <cite>Amazon Pay</cite> or <cite>Amazon Sign-in</cite> buttons elsewhere on a website<a class="headerlink" href="#q-i-d-like-to-add-a-amazon-pay-or-login-with-amazon-button-elsewhere-on-my-site" title="Permalink to this headline">¶</a></h2>
    <p>If you want to add <cite>Amazon Pay</cite> or <cite>Amazon Sign-in</cite> buttons to a new position on your website, you need to update the <strong>XML</strong> for the page you want to add it to.</p>
    <p>For instance, if you wish to add a <cite>Amazon Sign-in</cite> button to the category page you would update the following file.</p>
    <p>In your theme directory, you would create:
    <code class="docutils literal"><span class="pre">app/design/frontend/&lt;your_namspace&gt;/&lt;your_theme&gt;/Magento_Catalog/layout/catalog_category_view.xml</span></code></p>
    <div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;page</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">layout=</span><span class="s">&quot;1column&quot;</span> <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">&quot;urn:magento:framework:View/Layout/etc/page_configuration.xsd&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;body&gt;</span>
            <span class="nt">&lt;referenceBlock</span> <span class="na">name=</span><span class="s">&quot;category.products&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;block</span> <span class="na">class=</span><span class="s">&quot;Amazon\Login\Block\Login&quot;</span> <span class="na">name=</span><span class="s">&quot;amazon_login&quot;</span> <span class="na">after=</span><span class="s">&quot;category.products.list&quot;</span> <span class="na">template=</span><span class="s">&quot;Amazon_Login::login.phtml&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/referenceBlock&gt;</span>
        <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/page&gt;</span>
    </pre>
    </div>
    </div>
    <p>Here you are referencing the block <strong>category.products</strong> and then simply inserting the <cite>Amazon Sign-in</cite> button template into this block to be positioned after the block <strong>category.products.list</strong></p>
    <p>Likewise, If you wish to add a <cite>Amazon Pay</cite> button elsewhere in your store, you can follow the same process above, using a different template:</p>
    <div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;block</span> <span class="na">class=</span><span class="s">&quot;Amazon\Payment\Block\PaymentLink&quot;</span> <span class="na">name=</span><span class="s">&quot;amazon.pay.button&quot;</span> <span class="na">after=</span><span class="s">&quot;-&quot;</span> <span class="na">template=</span><span class="s">&quot;Amazon_Payment::payment-link.phtml&quot;</span> <span class="nt">/&gt;</span>
    </pre></div>
    </div>
    <p>You can position and target which block the button appears in as with the <cite>Amazon Sign-in</cite> button. If you need more information on how to position and add new blocks into Magento 2 please see the <a class="reference external" target="_blank" href="http://devdocs.magento.com/guides/v2.4/frontend-dev-guide/layouts/layout-overview.html">Magento 2 documentation</a></p>
    </div> -->
              </div>
            </div>
          </div>
          <footer>
            <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
              <a href="testing.html" class="btn btn-neutral float-right" title="Testing your integration"
                accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
              <a href="flow.html" class="btn btn-neutral" title="Order &amp; payment workflow" accesskey="p"><span
                  class="fa fa-arrow-circle-left"></span> Previous</a>
            </div>
            <hr />
            <div role="contentinfo">
              <p>
                &copy; Copyright 2021, Amazon.com Inc or its affiliates.
              </p>
            </div>
          </footer>
        </div>
      </div>
    </section>
  </div>
  <script type="text/javascript" src="_static/jquery.js"></script>
  <script type="text/javascript" src="_static/underscore.js"></script>
  <script type="text/javascript" src="_static/js/theme.js"></script>
</body>
</html>